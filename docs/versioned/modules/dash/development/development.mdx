---
sidebar_position: 1
sidebar_label: Development
---

# Dashboard Module Development

This guide covers developing with the Dashboard (DASH) module, including custom widget development, extending functionality, and integrating with the dashboard system.

## Development Environment Setup

### Prerequisites

Ensure you have the following setup:

- **Web-base project** with the DASH modlet installed
- **Development containers** running the backend services
- **Environment variables** configured in your `.env` file

### Local Development Services

The DASH module requires these backend services to be running:

```bash title="dev-containers"
# Start all required services
podman compose --env-file .env -f dash/compose.yml up -d
```

This starts:
- **dash-db**: PostgreSQL database for dashboard storage
- **dash-app**: Go backend service with REST API
- **iams-keycloak**: Authentication service
- **tag-app**: Tag management service


## Widget Structure Overview

Every widget follows this basic structure:

```
widgets/YourWidget/
├── index.svelte              # Main widget component
└── WidgetConfig/            # Optional configuration UI
    └── index.svelte
```

Widgets are automatically discovered at build time. Just create a folder in `$lib/aoh/dash/widgets/` with an `index.svelte` file, and it appears in the palette.

## Widget Metadata

Widgets must export metadata in their module script. At build time, the system automatically scans the widgets folder, discovers all exported metadata, and registers each widget in the application.

### Required Exports

These properties **must** be exported for the widget to appear in the palette:

| Property | Type | Description | Example | Notes |
|----------|------|-------------|---------|-------|
| `widgetTitle` | `string` | Display name in widget palette (UPPERCASE convention) | `"MY_WIDGET"` | Must be unique. Prefix with `_` to hide from palette (e.g., `"_TEMPLATE"`) |
| `widgetEnabled` | `boolean` | Whether widget appears in palette | `true` | Set to `false` to disable temporarily |
| `widgetMinWidth` | `number` | Minimum width in grid columns (1-12) | `4` | Dashboard uses 12-column grid system |
| `widgetMinHeight` | `number` | Minimum height in grid rows | `3` | Prevents widget from being too small |
| `widgetIcon` | `string` | Lucide icon name (kebab-case) | `"activity"` | Browse icons at [lucide.dev](https://lucide.dev) |

### Optional Exports

These properties enhance widget functionality but are not required:

| Property | Type | Description | Default | Example |
|----------|------|-------------|---------|---------|
| `widgetCategory` | `string` | Category for organizing widgets in palette | `undefined` | `"ANALYTICS"` |
| `widgetLimit` | `number` | Maximum instances allowed per dashboard | `999` | `5` |
| `widgetMaxWidth` | `number` | Maximum width in grid columns | `12` | `8` |
| `widgetMaxHeight` | `number` | Maximum height in grid rows | `undefined` | `6` |

### Example Metadata

```typescript title="Complete metadata example"
<script lang="ts" module>
  // Required exports
  export const widgetTitle = "INCIDENT_TRACKER";
  export const widgetEnabled = true;
  export const widgetMinWidth = 6;
  export const widgetMinHeight = 4;
  export const widgetIcon = "alert-triangle";

  // Optional exports
  export const widgetLimit = 3;
  export const widgetMaxWidth = 12;
  export const widgetMaxHeight = 8;
</script>
```

### Special Behaviors

**Fixed Size Widget:**
Set min and max to the same value to prevent resizing:
```typescript
export const widgetMinWidth = 6;
export const widgetMaxWidth = 6;  // Same as min = fixed width
export const widgetMinHeight = 4;
export const widgetMaxHeight = 4; // Same as min = fixed height
```

**Hidden Widget:**
Prefix title with underscore or set `widgetEnabled` to `false`:
```typescript
export const widgetTitle = "_INTERNAL_WIDGET";  // Hidden from palette
// OR
export const widgetEnabled = false;             // Disabled
```

## Widget Configuration

Widget configuration allows users to customize widget behavior without editing code. **Configuration is optional**—widgets can work perfectly fine without it. However, adding configuration is recommended for flexible, reusable widgets.

### Configuration Structure

Create a `WidgetConfig` folder inside your widget with its own `index.svelte`:

```typescript title="src/lib/aoh/dash/widgets/YourWidget/WidgetConfig/index.svelte"
<script lang="ts" module>
  // Define the configuration interface
  export interface Config {
    title: string;
    refreshInterval: number;
    showHeader: boolean;
  }

  // Provide default values
  export const defaults: Config = {
    title: "My Widget",
    refreshInterval: 60,
    showHeader: true
  };
</script>

<script lang="ts">
  import Input from "$lib/aoh/core/components/ui/input/input.svelte";
  import Label from "$lib/aoh/core/components/ui/label/label.svelte";
  import { Switch } from "$lib/aoh/core/components/ui/switch";

  // Config must be bindable for changes to persist
  let { config = $bindable() }: { config: Config } = $props();
</script>

<!-- Configuration UI -->
<div class="flex flex-col gap-4 p-4">
  <div>
    <Label for="title">Title</Label>
    <Input id="title" bind:value={config.title} />
  </div>

  <div class="flex items-center justify-between">
    <Label for="show-header">Show Header</Label>
    <Switch id="show-header" bind:checked={config.showHeader} />
  </div>
</div>
```

## Creating a Widget

Here's how to create a new custom widget:

#### 1. Create the Widget Component

```typescript title="src/lib/aoh/dash/widgets/<widget-name>/index.svelte"
<script lang="ts" module>

  //Widget metadata is exported in a special `module` script:
  export const widgetTitle = "MY_WIDGET";
  export const widgetLimit = 10;
  export const widgetEnabled = true;
  export const widgetMinWidth = 4;
  export const widgetMinHeight = 3;
  export const widgetMaxWidth = 12;
  export const widgetMaxHeight = 8;

  export const componentName = new URL(import.meta.url).pathname;
</script>

<script lang="ts">
  import { logger } from "@mssfoobar/logger/Logger";
  import { defaults, type Config } from "./WidgetConfig/index.svelte";
  

  let { config = $bindable(defaults) }: { config: Config } = $props();

  onMount(() => {
    if (!config) config = defaults;
    log.info("Widget mounted", { config });
  });
</script>

// Your widget code over here.
```

Widgets must export metadata in their module script. At build time, the system automatically scans the widgets folder, discovers all exported metadata, and registers each widget in the application.

#### 2. Using Configuration in Your Widget

Configuration is automatically passed to your widget through props. The dashboard system handles loading defaults, merging user settings, persisting changes to the database, and passing the updated config to your widget.

```typescript title="Receiving configuration via props"
<script lang="ts">
  import { type Config } from "./WidgetConfig/index.svelte";

  // Receive configuration via props
  let { config }: { config: Config } = $props();
</script>

<!-- Use config values in your widget -->
<div class="w-full h-full">
  {#if config.showHeader}
    <h2>{config.title}</h2>
  {/if}
  <p>Refresh interval: {config.refreshInterval}s</p>
</div>
```



### Widget Metadata Properties

Each widget must export these metadata properties:

| Property | Description | Example |
|----------|-------------|---------|
| `widgetTitle` | Unique identifier for the widget | `"MY_WIDGET"` |
| `widgetLimit` | Maximum instances per dashboard | `10` |
| `widgetEnabled` | Whether widget is available | `true` |
| `widgetMinWidth` | Minimum grid width | `4` |
| `widgetMinHeight` | Minimum grid height | `3` |
| `widgetMaxWidth` | Maximum grid width | `12` |
| `widgetMaxHeight` | Maximum grid height | `8` |

## Dashboard Service Integration

The DASH module provides a service layer for interacting with dashboards, widgets, and tags.


