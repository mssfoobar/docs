---
sidebar_position: 3
sidebar_label: API Guide
---

# API Guide

This guide provides an overview of the GIS module's API endpoints. The API is used for managing geospatial entities, bookmarks, and synchronizing data with the Real-Time Update Service (RTUS).

## Authentication

All API endpoints require a valid JWT access token. The token must be included in the `Authorization` header of each request.

**Headers:**

-   `Content-Type: application/json`
-   `Authorization: Bearer {token}`

## GeoEntity API

APIs for managing geospatial entities. GeoEntities represent geographic features with coordinates, properties, and metadata.

---

### 1. Get paginated geo entities

Retrieves a paginated list of geo entities for the authenticated user's tenant.

```http
GET /geoentity
```

#### Query Parameters

| Name | Type | Description | Default |
| ---- | ---- | ----------- | ------- |
| page | integer | Page number (0-indexed) | 0 |
| size | integer | Number of items per page | 10 |
| sort | array | Sort field and direction (e.g., 'name,asc') | ["id","asc"] |

#### Response

Returns a paginated list of geo entities.

```json
{
  "data": [
    {
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "occ_lock": 0,
      "geojson": {
        "type": "Feature",
        "geometry": { "type": "Point", "coordinates": [103.8, 1.3] },
        "properties": { "name": "Example" }
      },
      "entity_id": "cust-001",
      "entity_type": "static"
    }
  ],
  "page": {
    "number": 0,
    "size": 10,
    "total_records": 1,
    "count": 1,
    "sort": ["id"]
  }
}
```

---

### 2. Create geo entity

Creates a new geo entity with the specified data.

```http
POST /geoentity
```

#### Request Body

| Name | Type | Description |
| ---- | ---- | ----------- |
| geojson | object | Valid GeoJSON Feature object |
| entity_id | string | Optional custom business ID |
| entity_type | string | Type of entity (e.g., 'track', 'static') |

```json
{
  "geojson": {
    "type": "Feature",
    "geometry": {
      "type": "Point",
      "coordinates": [103.8198, 1.3521]
    },
    "properties": {
      "name": "Asset 1",
      "kind": "vehicle"
    }
  },
  "entity_id": "vehicle-001",
  "entity_type": "track"
}
```

#### Response

HTTP 201 Created. Matches the created entity structure.

---

### 3. Upsert geo entity

Creates or updates a geo entity based on its ID.

```http
PUT /geoentity
```

#### Request Body

Requires the full entity object including `id`.

```json
{
  "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "geojson": { ... },
  "entity_id": "vehicle-001",
  "entity_type": "track"
}
```

#### Response

HTTP 200 OK.

---

### 4. Batch Operations

Manage multiple entities in a single request for performance.

#### Batch Create

```http
POST /geoentity/batch
```

**Request Body**: Array of `GeoEntityBaseDto` objects (same as Create).

#### Batch Upsert

```http
PUT /geoentity/batch
```

**Request Body**: Array of `GeoEntityDto` objects (same as Upsert).

---

### 5. Get GeoEntity by ID

```http
GET /geoentity/id/{id}
```

```http
GET /geoentity/entity_id/{entityId}
```

Retrieves a specific geo entity by its system UUID (`id`) or business ID (`entity_id`).

---

### 6. Delete GeoEntity

```http
DELETE /geoentity/id/{id}
```

```http
DELETE /geoentity/entity_id/{entityId}
```

Deletes a specific geo entity.

**Batch Delete**:

-   `DELETE /geoentity/id/batch` (Body: Array of UUIDs)
-   `DELETE /geoentity/entity_id/batch` (Body: Array of strings)

---

### 7. Search GeoEntities

#### By Kind

Retrieves all geo entities of a specific kind (defined in GeoJSON properties).

```http
GET /geoentity/kind/{kind}
```

#### By Property

Retrieves a single geo entity matching a specific property key-value pair.

```http
GET /geoentity/property?property={key}&value={value}
```

---

## Bookmark API

APIs for managing map bookmarks. Bookmarks save camera positions including coordinates, zoom level, and orientation.

---

### 8. Get Bookmarks

```http
GET /bookmark
```

Retrieves a paginated list of bookmarks. Supports `page`, `size`, and `sort` query parameters.

---

### 9. Create Bookmark

```http
POST /bookmark
```

#### Request Body

| Name | Type | Description |
| ---- | ---- | ----------- |
| name | string | Name of the bookmark (Required) |
| lon | number | Longitude (-180 to 180) |
| lat | number | Latitude (-90 to 90) |
| alt | number | Altitude |
| zoom | number | Zoom level |
| pitch | number | Camera pitch |
| yaw | number | Camera yaw |
| roll | number | Camera roll |

```json
{
  "name": "Singapore View",
  "lon": 103.8198,
  "lat": 1.3521,
  "zoom": 12
}
```

---

### 10. Manage Bookmarks by ID

-   **Get**: `GET /bookmark/id/{id}`
-   **Update**: `PATCH /bookmark/id/{id}` (Requires `occ_lock`)
-   **Delete**: `DELETE /bookmark/id/{id}`

---

## Sync API

APIs for synchronizing GIS data with RTUS (Real-Time Update Service). Used by developers to manage data consistency between systems.

---

### 11. Full Sync

Performs a full re-sync: deletes everything in RTUS json-map and repopulates with all GIS entities.

```http
POST /sync/full
```

#### Response

```json
{
  "message": "Full sync completed",
  "total_synced": 150
}
```

---

### 12. Partial Sync

Only adds missing entities to RTUS and removes orphaned keys. Does not update existing keys containing data differences.

```http
POST /sync/partial
```

---

### 13. Get Sync Differences

Compares GIS database with RTUS json-map and reports differences.

```http
GET /sync/diff
```

#### Response

```json
{
  "only_in_gis": ["uuid-1", "uuid-2"],
  "only_in_rtus": ["uuid-3"],
  "in_both_count": 100,
  "gis_total": 102,
  "rtus_total": 101
}
```
