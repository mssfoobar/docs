---
sidebar_position: 2
sidebar_label: Recording namespace
---

# Deploy Recording namespace

-   Navigate to manifest/recording folder
-   Fullfil and correct variables in `recording-configmap.yml` and `debezium-rtus-configmap.yml`

**About the debezium deployment**
- For each live database, there will be a debezium deployment. All of them have to have the same `subject` for nats connector. Need to focus on the `debezium.source.topic.prefix` and `debezium.sink.nats-jetstream.subjects` config in debezium configmap.
    - For example, if we have 2 live databases: `aoh_sys` and `aoh_gis`
        - The `debezium.source.topic.prefix` for `aoh_sys` will be `aoh.live.postgres`
        - The `debezium.sink.nats-jetstream.subjects` for `aoh_sys` will be `aoh.live.postgres.*.*`
        - The `debezium.source.topic.prefix` for `aoh_gis` will be `aoh.live.postgres`
        - The `debezium.sink.nats-jetstream.subjects` for `aoh_gis` will be `aoh.live.postgres.*.*`
        - And `NATS_DEBEZIUM_SUBJECT` in `transform msg` module will be `aoh.live.postgres.*`

:::info
Configration: [Config](../configuration/recording.mdx)
:::

-   Create a recording configmap

```bash
kubectl apply -f recording-configmap.yml
```

-   Create a debezium-rtus-configmap

```bash
kubectl apply -f debezium-rtus-configmap.yml
```

-   Create a debezium for rtus deployment

```bash
kubectl apply -f debezium-rtus-deployment.yml
```

-   Create a recording deployment

```bash
kubectl apply -f recording-deployment.yml
```

-   Create a recording service (for scheudlejob configuration API)

```bash
kubectl apply -f schedulejob-service.yaml
```

- There is a new configmap for recording namespace, that is `live-db-configmap.yaml`. This including the live databases information.
The configmap is used to store the live databases information, and it will be used by the schedulejob to take snapshot of the live databases.

```bash
kubectl apply -f live-db-configmap.yaml
```
